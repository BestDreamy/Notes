# 以太网协议

stm32f407配置了以太网外设，可以按照IEEE 802.3-2002标准进行以太网通信

## MAC内核特性

* 支持外部PHY接口实现**10/100Mbits/s数据传输速率**
* 半双工/全双工适应
* **报头和帧起始数据（SFD）在发送路径中插入、在接收路径中删除**，计算IPv4头校验和 与 TCP、UDP、ICMP校验和 并将其插入在存储转发模式下发送的帧中
* 可逐帧控制CRC和pad自动生成，接收帧时可自动去除pad/CRC
* **可编程帧长度（支持16KB的巨型帧）、可编程帧间隔（40-96位时间，以8为步长）**
* 支持**多种**灵活的**地址过滤模式**，配备4个48为完美（DA）地址过滤器、3次48位SA地址比较检查、可选64位Hash滤波器（多播、单播适用）、支持混合模式，无需过滤网络监视、传送所有数据包（每次过滤）时均附有一份状态报告
* 发送和接收数据包分别返回32位状态
* **为应用程序提供单独的发送、接收和控制接口**
* 接收功能中**支持IPv4和TCP数据包**，增强型接收功能中**支持检查IPv4头校验和IPv4/IPv6数据包中封装的TCP、UDP、ICMP校验和**
* **支持以太网时间戳**，每个帧收发时给出64位时间戳
* 配备**2组FIFO**：可编程阈值的2KB发送FIFO 和 可编程阈值（默认为64字节）的2KB接收FIFO；接收FIFO进行多帧存储时，通过在EOF传输后向接收FIFO插入接收状态矢量，从而使接收FIFO无需存储这些帧的接收状态
* **存储转发模式**下可以在接收时**过滤所有错误帧**，不将这些错误帧转发给应用程序，可转发过小的好帧
* 为接收FIFO中丢失或损坏的帧生成脉冲，可以统计丢帧
* 向MAC内核发送数据时支持存储转发
* **发送时处理冲突帧的自动重新发送，丢弃延迟冲突、过度冲突、过度延迟和下溢条件下的帧**
* 可软件控制刷新Tx FIFO
* 支持调试时通过MII进行内部回送

## DMA特性

* 支持所有AHB突发类型、**软件在AHB主接口中选择AHB突发类型为固定或不确定突发**、可从AHB主端口选择地址对齐突发
* **支持ui数据缓冲区进行字节对齐寻址**
* 双缓冲区（环）或链表（链接）描述符链接，采用描述符架构可以在CPU几乎不干预的情况下传输大型数据块，**每个描述符可传输高达8KB数据**
* 报告正常工作和传输错误时的综合状态
* 可为收发DMA控制器单独编程突发大小来充分利用主总线，**可编程中断**
* 可按帧控制发送、接收完成中断，配备启动、停止模式
* 接收/发送引擎间采用**循环调度仲裁**或**固定优先级仲裁**
* 当前的Tx/Rx缓冲区指针和描述区指针作为状态寄存器

## PTP特性

* 接收帧/发送帧时间戳，支持粗略校准和精细较准，系统时间大于目标时间时可触发中断
* 输出秒脉冲

# STM32的以太网实现

## 以太网引脚

==**所有MAC信号映射到AF11**==

详见参考手册













