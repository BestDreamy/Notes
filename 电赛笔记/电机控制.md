# 直流电机控制

根据电机学，直流电机转速
$$
n=\frac{U-IR}{K\phi}
$$
其中U为电枢端电压，I为电枢电流，R为电枢电路总电阻，Φ为每极磁通量，K为电机结构参数

直流电动机的转速控制方法有两种

* 励磁控制法：对励磁磁通进行控制
* 电枢控制法：对电枢电压进行控制

励磁控制阀在低速状态下收到磁极饱和限制，在高速时受换向火花和换向器结构强度的限制，动态响应较差，因此很少使用；大多数应用场合都使用电枢电压控制法，在保证励磁恒定的情况下使用单片机或相关电子器件输出**PWM**来直接实现直流电动机调速

## 直流电机调速

直流电机的调速思路就是“力大砖飞”，在电机控制线两端加适当电压，电压越高转速越快。可以通过功率半导体器件产生恒定的电压供给电机；对于数字器件而言很难控制电压精准保持在某一模拟值，因此使用PWM进行调速。

无论是模拟方法还是数字方法，都需要使用功率半导体器件，只不过使用方式有所不同。模拟电路通过线性放大的驱动方式，输出波动小、线性好，对临近电路干扰小，但存在效率低和散热问题；而数字电路通过耦合器件发出PWM使功率器件输出方波加在电机两端，通过改变方波的占空比来实现调节电机转速，往往对临近电路存在干扰，但是更易于实现。

基于PWM调速的电路往往包含三个部分

### 驱动电路

一般使用晶体管或场效应管构成的半桥、全桥、三相桥电路，或直接使用护照那用的电机驱动功率IC。

常见的电机驱动芯片有L298N、ULN2003等

半桥拓扑采用推挽输出，**需要保证两晶体管不同时开合**

全桥拓扑又称H桥，需要确定一个死区时间，在同一时间只有两个对称的桥臂晶体管导通，**绝对不能让四路晶体管同时导通**

三相桥需要更严谨的时间控制，如果出现桥臂同时导通的情况很可能导致炸管

三者适用的功率逐次增大

还要注意电机两端应跨接续流二极管

### 隔离电路

一般来说直流电机的驱动电压都在6V及以上，而常见的MCU供电、输出电压都在3.3V-5V，因此二者之间通常需要隔离

隔离器件可以是光耦、数字隔离器等

通常由于隔离设备的驱动能力不足，还需要在输出端加入三极管、场效应管放大电路或图腾柱推挽输出电路。比较方便的解决方案是直接使用达林顿管对电机进行控制，但是需要考虑达林顿管的耐压和发热

### 控制电路

大多数MCU都具有PWM输出功能，高性能的MCU往往还会配备控制死区时间、可以快速调节占空比、实现多路PWM同步/反相的高级控制功能；低端MCU也往往可以通过延时程序配合GPIO输出实现不精确的PWM功能

改变占空比的基本控制方法有：

* 定宽调频法：保持PWM占空比不变，改变输出频率
* 定频调宽法：保持PWM频率不变，改变占空比
* 调频调宽法：不常用，同时改变频率和占空比

# 步进电机控制

步进电机是一种将电脉冲转化为角位移的电机机构。当它收到一个脉冲信号，就会按照设定的方向转动一个固定的角度，该角度称为电机的**步距角**。可以通过控制脉冲个数来控制角位移量；可以通过控制脉冲频率实现步进电机的调速

步进电机的转子一般为多极分布，定子上嵌有多相星形连接的控制绕组，每输入一次电脉冲信号，转子就旋转一步。步进电机的种类很多，可大致分成：

* 反应式
* 永磁式
* 混合式

还可以按相数分为单相、两相、三相三种

**如果给处于错齿状态的相通电**，则转子会向磁导率最大、磁阻最小的位置转动，也就是**趋于齿运动**

一个步进电机中往往还会加入减速装置来让其达到更高的精度，获得更高的转动力矩。

# 舵机控制

舵机也称伺服电机、伺服驱动器，它接受一定的控制信号，输出一定的角度，适用于需要角度不断变化并可以保持的控制系统

舵机实际上是一个独立的闭环控制系统，通过其内部的机械或电路反馈控制其角度

工作过程如下：

1. 控制器向舵机发出控制信号
2. 内部电路判断转动方向
3. 驱动电路控制无核心马达转动
4. 动力通过减速齿轮传送到摆臂
5. 位置检测器回传摆臂数据
6. 如果未达到指定位置则继续运动，否则停止

其中位置检测器一般使用可变电阻，当舵机转动时电阻值会跟着改变，由此可以判断舵机是否达到指定位置

## 舵机控制方法

标准舵机由电源、地线、控制线三条连接线，电源电压通常为4-6V，一般使用5V供电即可，但是需要电源带载能力够强。控制线一般输入方波信号，周期一般为20ms（频率50Hz）即可，具体情况应查看舵机生产商的说明。通过改变方波的占空比来改变舵机的角度，舵机角度和脉冲宽度成正比

舵机一般可以提供相当强的扭力，所以可以选择大扭力舵机用在机械臂等需要高强度的地方

