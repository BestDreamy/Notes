# 模拟数字混合电路

**电路特性**：数字电路的频率高，模拟电路的敏感度高

高频的信号线应尽可能远离敏感的模拟电路器件

在板内，数字地和模拟地实际上是分开的，只是在PCB与外界连接的接口处有一点短接

模拟地/模拟电源与数字电源通过电感/磁珠单点连接

**设计技巧**：两个地起不同的名字，分别辅铜，最后可以**用一个10uH电感（最大不超过100uH）或0欧姆电阻连起来**，模拟部分的器件尽量集中，放置在与其它板子接口的附近，减小信号衰减。先对模拟地敷铜，然后对整个板敷数字地。

**干扰三要素**：1. 干扰源（$\frac{di}{dt}$， $\frac{du}{dt}$大的地方就是干扰源）；2. 干扰传播路径（通过导线的传导和空间的辐射等）；3. 敏感器件（ADC、数字IC、AMP等容易被干扰的器件）

## 抗干扰设计原则

* 抑制干扰源：减小$\frac{di}{dt}$， $\frac{du}{dt}$

  基本方法：

  1. 在干扰源回路串联电感或电阻
  2. 给电机加滤波电路，减小电容、电感引脚长度
  3. 在大电感旁边增加续流二极管
  4. 在继电器接点两端并接火花抑制电路（RC串联电路，电阻一般选几K到几十K，电容选0.01uF）
  5. 电路板上每个IC的VCC和GND引脚间要并接一个0.01μF~0.1μF高频电容，以减小IC对电源的影响；电容布线应尽量粗短、靠近电源端
  6. 布线时避免90度折线，减少高频噪声发射
  7. 可控硅两端并接RC抑制电路，减小可控硅产生的噪声

* 切断干扰传播路径：切断传导干扰、减小辐射干扰

  基本方法：

  1. 要给单片机电源加滤波电路或稳压器，以减小电源噪声对单片机的干扰（可以利用磁珠、电阻和电容组成π形滤波电路，尽量不要用LC滤波）
  2. 如果单片机的I/O口用来控制电机等噪声器件，在I/O口与噪声源之间最好加隔离（增加π形滤波电路）
  3. 晶振与单片机引脚尽量靠近，用地线把时钟区隔离起来，晶振外壳接地并固定
  4. 电路板合理分区，尽可能把干扰源与敏感元件远离，最好用地线把数字区与模拟区隔离，数字地与模拟地要分离，最后在一点接于电源地，单片机和大功率器件的地线要单独接地，以减小相互干扰
  5. 在单片机I/O口，电源线，电路板连接线等关键地方使用抗干扰元件如磁珠、磁环、电源滤波器，屏蔽罩，可显著提高电路的抗干扰性能

* 提高敏感器件的抗干扰性能

  提高敏感器件的抗干扰性能是指从敏感器件这边考虑尽量减少对干扰噪声的拾取，以及从不正常状态尽快恢复的方法

  基本方法：

  1. 布线时尽量减少回路环的面积，以降低感应噪声
  2. 电源线和地线要尽量粗，减小压降、降低耦合噪声
  3. 单片机闲置的I/O口不要悬空，要接地或拉高；IC的闲置端在不改变系统逻辑的情况下接地或接电源
  4. 对单片机使用电源监控及看门狗电路
  5. 在速度能满足要求的前提下，尽量降低单片机的晶振和选用低速数字电路
  6. IC器件尽量直接焊在电路板上，少用IC座

## 布线技巧

以下内容转自知乎https://www.zhihu.com/question/33455263/answer/1697154500

4层板从上到下依次为：信号平面层、地、电源、信号平面层

6层板从上到下依次为：信号平面层、地、信号内电层、信号内电层、电源、信号平面层

6层以上板(优点是：防干扰辐射)，优先选择内电层走线，走不开选择平面层，**禁止从地或电源层走线**(原因：会分割电源层，产生寄生效应)

多电源系统的布线：如FPGA+DSP系统做6层板，一般至少会有3.3V+1.2V+1.8V+5V，**3.3V**一般是主电源，**直接铺电源层**，通过过孔很容易布通全局电源网络；5V一般可能是电源输入，只需要在一小块区域内铺铜。且尽量粗，越粗越好；1.2V和1.8V是内核电源，布局时尽量将1.2V与1.8V分开，并让1.2V或1.8V内相连的元件布局在紧凑的区域，使用铜皮的方式连接

电源与地线靠近走线，注意减小回路面积，这样能降低电磁干扰

因为电源网络遍布整个PCB，如果采用走线的方式会很复杂而且会绕很远，使用**铺铜皮**的方法是一种很好的选择

**邻层之间走线采用交叉方式**

晶振离芯片尽量近，且晶振下尽量不走线，铺地网络铜皮

连接器上信号的排布对布线的难易程度影响较大，因此要**边布线边调整原理图上的信号**(但**千万不能重新对元器件编号**)

# 纯模拟电路

## 直流稳压电源设计

直流稳压电源电路一般由变压、整流、滤波、稳压四部分组成。

变压器一般选用市电隔离变压器即可，功率足够大就能用

### 整流

整流电路将交流电压变成脉动直流，它主要有半波整流（半桥）、全波整流（全桥）方式，可以由整流二极管构成整流桥堆来执行，常见的整流二极管有IN4007、IN5148等，桥堆有RS210、DB104等

对于桥式（一般使用全桥）整流电路，

每只二极管或桥堆所承受的最大反向电压为$U_{RM}=\sqrt{2}U_1$

每只二极管的平均电流为$I_{D(AV)}=\frac{1}{2}I_R=\frac{0.45U_1}{R}$

### 滤波

滤波电路将脉动直流滤除纹波，变成纹波小的直流，常见电路有RC滤波、KL滤波、π型滤波等，常用RC滤波电路

RC滤波电路中，RC放电时间常数应满足$RC=\lambda T/2$

其中$3\le \lambda \le 5$，T为输入交流信号周期

### 稳压

滤波电路输出电压经稳压后才能输出较稳定的电压。常见的稳压电路有三端稳压器、串联式稳压电路等

市面上大多数**三端固定式正压稳压器**均命名为78系列，引脚为IN、OUT、ADJ/GND。该系列稳压器有过流、过热和调整管安全工作区保护，可以防止过载损坏。名称中*78后面的数字代表稳压器输出的正电压数值*（一般常用05、09、12、15、20、24等），78前面冠以不同的英文字母为系列代号。78系列稳压器最大输出电流分100mA、500mA、1.5A三种，以插入的字母（可能在78前也可能在78后）来表示。插入L表示100mA；插入M表示500mA；不插入字母表示1.5A。此外，78（L、M）××的后面往往还附有表示输出电压容差和封装外壳类型的字母。常见的封装形式有TO-3金属、TO-92小型塑封和TO-220的中型塑封，其中金属封装形式输出电流可以达到5A，一般来说在弱电设计中不常用

实际应用中，芯片输入、输出端与地之间除分别接大容量滤波电容（100uF以上）外，通常还需在芯片引出脚根部接小容量（0.1µF~10µF）电容Cin、Cout到地，用于**抑制芯片自激振荡**、**滤除高频杂波**，Cout还有压窄芯片的高频带宽，**减小高频噪声**的功能。Cin和Cout的具体取值依照datasheet定

而负电压稳压器一般命名为79系列，和78系列除了输出伏电压外其他参数一样

还有三段可调式稳压器，品种繁多，如正压输出的317（217/117）系列、123系列、138系列、140系列、150系列；负压输出的337系列等

一般调压输出电路公式为$U_O=1.25(1+\frac{R_p}{R_i})$

其中R~p~为电位器，接在ADJ脚与地之间，R~i~为反馈电阻，接在输出与ADJ之间，一般取值为120～240Ω，**输出端与调整压差为稳压器的基准电压**（典型值为1.25V），流经电阻R1的泄放电流为5～10mA

负压输出的LM337系列除了输出电压极性、引脚定义与LM317不同外，其他特点都相同

### 正负输出稳压电源

正、负输出稳压电源能同时输出两组数值相同、极性相反的恒定电压，一般使用输出电压极性不同的两片集成稳压器接在相同的**两路**滤波电路输出端

注意==输出部分一定要接入钳位二极管和电容==，否则容易造成电流倒灌

### 斩波调压电源电路

MC33063A/MC34063A/MC35063A是单片DC/DC变换器控制电路，只需配用少量的外部元件，就可以组成升压、降压、电压反转DC/DC变换器。电压输入范围为3~40V，支持调压输出且输出开关电流可达1.5A、工作频率可达100kHz，内部参考电压精度为2％

其内部包含1.25V基准电压、反向输入比较器、开关管驱动电路、振荡器（由外部定时电容驱动，使用锁存器辅助输出的数字器件）

主要用于制作升压、降压DC/DC变换器、电压反转式DC/DC变换器

详细内容参考datasheet即可

### 常见电源IC

以下内容整理自https://zhuanlan.zhihu.com/p/258490483

#### DC/DC降压

* TPS54541，输入电压4.5V\~42V，输出电压可设置为0.8V\~41V，最大输出电流5A
*  TPS54140，输入电压3.5V\~42V，输出电压可设置为0.8V\~39V，最大输出电流1.5A
* TLV62569，输入电压2.5V~5.5V，输出电压最低0.6V、最高到输入电压，最大输出电流2A,芯片体积很小
* MP2451，输入电压3.3V~36V，输出电压最低0.8V、最高0.8倍输入电压，最大输出电流0.6A
* MP2269，输入电压3.3V~30V，输出电压最低0.8V，最大输出电流1A，芯片体积很小
* LTC3370，4路输出，输入3.3V或5V，输出最低0.8V，最高与输入电压一样，最大输出电流总共8A，可以给4路各自分配0-4A

#### DC/DC升压

boost芯片的参数里，有一个跟buck有很大的区别，就是输出电流，boost的原理决定了其输出电流分为充电和放电两个阶段，充放电是否连续、占空比的大小、等效负载电阻的大小，共同决定了输出电压和电流的大小，因此**boost芯片根据输入和输出电压的不同，其连续输出电流值是不同的**，因此**只有“开关电流”这个参数能用于大致的估计**，这个参数如何估计和计算，对新手来说还是太复杂了，建议大家**直接通过datasheet中的图表确认其实际的电流输出能力**。

* TPS61085A，输入电压2.3V到6V，输出电压2.8V到18.5V
* TPS61390，输入电压2.5 V to 5.5 V，输出电压最高85V
* TPS61040，可用于LCD屏背光的升压芯片，输入电压5V，boost输出电压10.4V，用于LCD背光二极管电源
* CAT4237，野火开发板的液晶屏背光的升压芯片

#### LDO

LDO的效率只能用悲剧来形容，所以一般只用于单片机开发板或测试电源

LDO使用起来非常简单，电压、电流、纹波、发热等参数匹配，直接使用就可以了

* LM1117，输入电压2.6V到15V，输出电压1.25V到13.8V，最大输出电流0.8A，还有固定电压输出的版本，1.8V, 2.5V, 3.3V, 5V
* LY1117A，参数类似于LM1117，国产，非常便宜
* AMS1117，参数类似于LM1117，效率似乎要高一些，但是贵

# 纯数字电路

## 通用的MCU电路设计









## 板级信号传输设计