# 使用C语言进行PC程序开发









## 版本控制工具

版本控制系统，往往以英文缩写为RCS，其目的是保存一个项目在开发过程中的众多版本的代码快照或开发过程中的阶段

版本控制系统主要提供三种基础功能

* 为文件系统提供一个时间维度——**记录**
* 记录项目的不同版本——**分支**
* 将源代码有序保存以备使用——**管理**
* 方便地融合不同分支——**分布式**

### diff工具

最简单的版本控制工具就是diff和patch

这两个工具隶属于POSIX标准，使用以下命令就可以显示出文件之间被改动的几行

```shell
diff docA docB
```

使用管道将输出导入文本文件，即可从文本编辑器中读取到经过高亮的版本

```shell
diff docA docB > history.txt
```

输出中使用+和-标记出了增加或被移除的某些行，可以使用-u参数得到在增加/删减周围的几行内容

导出的文本文件称为**改变列表**

使用patch工具可以读取diff文件并执行改变列表

```shell
patch < history.txt
```

上面的命令可以通过已有的改变列表应用改动到一份之前的代码

如果已经删除了老版本的文件，可以使用以下命令将后一个版本的文件回退到前一个版本，这个过程称为**回滚**

```shell
patch -R < history.txt
```

这两个工具很原始，所以现在没什么用了，但他们的版本控制思想正是Git诞生的源泉

### Git工具

Git是一个C程序，基于一组*对象*提供服务

Git中最基础的是**提交**对象（commit），这个对象类似diff，可以将当前目录下所有代码信息打包

提交对象连接起来形成了一个*树*，每个提交对象有且至少有一个父提交对象，在Git中的版本切换就是在上下遍历提交对象树

### Git工具的使用

1. 创建新的版本库

   ```shell
   git init
   ```

   使用上面的命令创建一个.git目录，并将有关该版本库的所有信息保存在这个目录下

   注意：**.git目录是Git工具实现功能的最重要依托，如果删除了当前目录下的.git目录，git工具所有的历史记录就失效了**

   如果想删除一个版本库，只要

   ```shell
   rm -rf .git
   ```

   如此简单！

2. 从网络获取源代码

   ```shell
   git clone https://gitee.com/redlightasl/notes.git
   ```

   使用上面的代码可以从远程的代码库复制代码到本机

   也可以用类似的方式克隆一个本机上位于其他目录的工程

3. 产生差异并提交

   使用

   ```shell
   git add balabala
   ```

   来存储当前工程文件中发生变化的部分

   可以直观理解成这个指令保存当前工程文件的快照

   如果想要保存所有文件，使用

   ```shell
   git add .
   ```

   即可将所有文件加入一个称为**Index**的变化列表，这个变化列表记录了当前所发生的文件和内容变更

   同时也有如下命令

   ```shell
   git rm file
   git mv a_file another_file
   ```

   含义简洁明了，任何知道linux shell怎么用的人都能快速上手

   在产生差异后就能生成提交了：

   ```shell
   git commit -m "a new commit"
   ```

   这是一个标准的提交指令格式

   -m参数后面跟要在提交中附加的注释说明

   运行

   ```shell
   git log
   ```

   可以查看这些注释消息

   如果你忘记加上这个参数，Git工具会使用环境变量${EDITOR}指示的文本编辑器（在windows下会打开git自带bash shell里面的vi），用户可以自行输入消息

   如果在提交前不想使用git add，可以在commit后面加参数-a，这样就可以省去add了

4. 查看提交对象的内容

   Git工具中将提交的所有数据称为元数据

   最关键的元数据就是提交对象的名字，Git为每份提交都生成了一个独一无二的SHA1编码，在提交后可以看到提交对象的哈希数值的前几个数字，可以运行

   ```shell
   git log
   ```

   来查看当前提交对象的历史提交对象列表

   如果想要查看版本号为**abcde后面省略**的代码，可以直接使用指令

   ```shell
   git checkout abcde
   ```

   也就是后接哈希码的前5个字符（一般这么多字符足够区分两个不同的版本，如果发现不行那就再多往后写几位）

   这样可以将项目重置为这个版本

   在查看完以后，可以使用

   ```shell
   git checkout master
   ```

   来恢复到最新状态

   master是Git工具中的一个指向主要版本的指针

   类似的还存在HEAD指针，它永远指向最新的一份提交

5. 查看更改

   使用

   ```shell
   git diff > diffs.txt
   ```

   来将当前的文件更改输出到文件中，Git可以精确到多个提交的比较

   ```shell
   git dff 234sd 65sf2 
   ```

   同时为了避免使用繁杂的十六进制哈希值，Git工具为提交的tag做出了更多简化

   HEAD代表目前最后一个提交

   ~1代表当前提交的父提交

   ~2代表当前提交的祖父提交

   以此类推

### Git版本树结构

版本库中有一个树状结构，不仅可以通过提交实现版本回滚，还可以通过树的分支（fork）实现功能并行和分支代码

在树状结构中，称最长的分支为主分支

习惯上，一般保持主分支随时拥有完整的功能，实验性的功能或特性可以通过创建新分支来修改

使用

```shell
git branch newbranch
git checkout newbranch
```

来创建并切换到新分支

使用

```shell
git branch
```

来查询当前工作在哪个分支

使用

```shell
git branch -m new_branch_name
```

来命名一个分支

当某一分支功能完成时，可以通过

```shell
git checkout master #切换到主分支
git merge newbranch #融合之前的分支
```

来实现功能融合

特别地，如果两个分支派生后又各自存在一定变化，merge就会受阻

这时候需要使用

```shell
git status
```

来检查未融合的文件列表，一个一个文件修改、add、提交，并手工将其合并进主分支

### 远程版本库

如果你的版本库存在一个远程的列标，指向与这个库有关的存放在别处的版本库，那么可以使用git clone获得远程版本库

通过以下指令方便地在远程库和本地库之间得到同步

```shell
git pull xxx #从远程版本库中拉取远程变化
git push xxx #将本地的变化推送到远程版本库
```

这两个指令是最常用的版本控制指令，可以实现在github和本地之间同步代码

特别地，如果本地代码和从远程库中拉取的代码存在不同，需要使用git merge指令加以融合